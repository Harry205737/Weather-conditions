<!DOCTYPE html>
<html>
<head><title>LiteWeather</title></head>
<body>
  <strong>3-Day Forecast</strong>
  <p id="m">Locating...</p>
  
  <table border="1" cellpadding="5" style="border-collapse: collapse;">
    <thead>
      <tr>
        <th>Date</th>
        <th>Conditions</th>
        <th>High / Low</th>
      </tr>
    </thead>
    <tbody id="o"></tbody>
  </table>

  <script>
    const m=document.getElementById('m'), o=document.getElementById('o');
    
    const W=(c)=>{
      const s={
        0:'Clear sky', 1:'Mainly clear', 2:'Partly cloudy', 3:'Overcast',
        45:'Fog', 48:'Rime fog', 51:'Light drizzle', 53:'Mod. drizzle',
        55:'Dense drizzle', 61:'Slight rain', 63:'Mod. rain', 65:'Heavy rain',
        71:'Slight snow', 73:'Mod. snow', 75:'Heavy snow', 77:'Snow grains',
        80:'Slight showers', 81:'Mod. showers', 82:'Violent showers',
        95:'Thunderstorm', 96:'Storm + hail'
      };
      return s[c] || 'Code '+c;
    };

    navigator.geolocation.getCurrentPosition(async(p)=>{
      try {
        const {latitude:lt,longitude:lg}=p.coords;
        m.innerText=`Lat: ${lt.toFixed(2)}, Lon: ${lg.toFixed(2)}`;
        const r=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lt}&longitude=${lg}&daily=weathercode,temperature_2m_max,temperature_2m_min&forecast_days=3&timezone=auto`);
        const d=await r.json();
        
        d.daily.time.forEach((t,i)=>{
          const parts = t.split('-'); // [YYYY, MM, DD]
          const dateDM = `${parts[2]}/${parts[1]}`; // DD/MM
          
          const row = o.insertRow();
          row.innerHTML = `
            <td>${dateDM}</td>
            <td>${W(d.daily.weathercode[i])}</td>
            <td>${Math.round(d.daily.temperature_2m_max[i])}° / ${Math.round(d.daily.temperature_2m_min[i])}°</td>
          `;
        });
      } catch(e){m.innerText='Sync error.';}
    }, ()=>m.innerText='GPS denied.');
  </script>
</body>
</html>
