<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Victoria Conditions</title>
</head>
<body>

<h1>Victoria Conditions</h1>

<h2>Fire Danger Ratings (BOM)</h2>
<div id="fdr">Loading fire danger ratings...</div>

<h2>Emergency & Watch/Act Warnings</h2>
<div id="warnings">Loading warnings...</div>

<h2>Current Weather</h2>
<div id="weather">Loading weather...</div>

<h2>3 Day Forecast</h2>
<div id="forecast">Loading forecast...</div>

<script>

// ------------------------------
// REPLACE WITH YOUR LOCATION
// ------------------------------
const lat = -37.8136;
const lon = 144.9631;

// ===== FIRE DANGER RATINGS (BOM TEXT SCRAPE) =====
fetch("https://corsproxy.io/?https://www.bom.gov.au/vic/forecasts/fire-danger-ratings.shtml")
  .then(r => r.text())
  .then(text => {
    // Very simple extraction of ratings lines (approx)
    // Finds table rows with district info
    const matches = text.match(/(Central|East Gippsland|Mallee|North Central|North East|Northern Country|South West|West and South Gippsland|Wimmera)[^<]*/g);
    if (matches) {
      document.getElementById("fdr").innerHTML = matches.join("<br>");
    } else {
      document.getElementById("fdr").innerText = "No fire danger ratings found";
    }
  })
  .catch(() => {
    document.getElementById("fdr").innerText = "Unable to load fire danger ratings";
  });

// ===== EMERGENCY WARNINGS (VicEmergency) =====
fetch("https://data.emergency.vic.gov.au/public/events-geojson.json")
  .then(r => r.json())
  .then(data => {
    const incidents = data.features
      .filter(f => f.properties.category1 === "Emergency Warning" || f.properties.category1 === "Watch and Act")
      .slice(0, 5);
    if (incidents.length === 0) {
      document.getElementById("warnings").innerText = "None";
    } else {
      document.getElementById("warnings").innerHTML = incidents
        .map(i => i.properties.category1 + ": " + i.properties.incidentName)
        .join("<br>");
    }
  })
  .catch(() => {
    document.getElementById("warnings").innerText = "Unavailable";
  });

// ===== WEATHER & 3 DAY FORECAST (Open-Meteo) =====
fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max&forecast_days=3&timezone=auto`)
  .then(r => r.json())
  .then(data => {
    const c = data.current_weather;
    document.getElementById("weather").innerText =
      "Temp: " + c.temperature + "°C | Wind: " + c.windspeed + " km/h";

    const d = data.daily;
    let html = "";
    for (let i = 0; i < 3; i++) {
      html += d.time[i] + ": " +
              d.temperature_2m_min[i] + "°-" +
              d.temperature_2m_max[i] + "° | Rain: " +
              d.precipitation_probability_max[i] + "%<br>";
    }
    document.getElementById("forecast").innerHTML = html;
  })
  .catch(() => {
    document.getElementById("weather").innerText = "Unavailable";
    document.getElementById("forecast").innerText = "Unavailable";
  });

// Refresh every 10 mins
setTimeout(() => location.reload(), 600000);

</script>

</body>
</html>
